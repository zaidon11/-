<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø±Ø·Ø¨Ø§Øª Ø§Ù„Ø£Ù…ÙŠØ±</title>
    
    <link rel="icon" type="image/png" href="https://image2url.com/r2/default/images/1771194774875-a0a45af5-73d3-4219-8403-d5fe683da053.png">
    <link rel="apple-touch-icon" href="https://image2url.com/r2/default/images/1771194774875-a0a45af5-73d3-4219-8403-d5fe683da053.png">
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #1e3a8a;
            --plus: #10b981;
            --minus: #ef4444;
            --action: #3b82f6;
            --bg: #f8fafc;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--bg);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 0;
        }

        .app-container {
            width: 90%;
            max-width: 450px;
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
            margin-bottom: 20px;
        }

        header img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin-bottom: 10px;
            object-fit: cover;
            border: 2px solid var(--primary);
        }

        header h1 { color: var(--primary); margin: 5px 0; }
        
        .meal-counter-badge {
            background: var(--action);
            color: white;
            padding: 5px 15px;
            border-radius: 50px;
            font-size: 14px;
            display: inline-block;
            margin-bottom: 20px;
        }

        .item-card {
            background: #fff;
            border: 2px solid #f1f5f9;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .item-name { font-size: 1.3rem; font-weight: bold; color: #1e293b; margin-bottom: 15px; }

        .controls { display: flex; justify-content: center; align-items: center; gap: 25px; }

        .btn {
            width: 65px; height: 65px; border-radius: 15px; border: none;
            font-size: 30px; color: white; cursor: pointer;
            display: flex; align-items: center; justify-content: center; transition: 0.1s;
        }

        .btn:active { transform: scale(0.9); opacity: 0.8; }
        .btn-plus { background-color: var(--plus); box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3); }
        .btn-minus { background-color: var(--minus); box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3); }

        .counter-val { font-size: 38px; font-weight: 800; color: var(--primary); min-width: 60px; }

        .btn-new-meal {
            background: var(--action); color: white; border: none; padding: 15px;
            border-radius: 12px; font-size: 18px; font-weight: bold; cursor: pointer;
            width: 100%; font-family: 'Cairo'; margin-top: 10px; box-shadow: 0 4px 10px rgba(59, 130, 246, 0.3);
        }

        .history-container {
            width: 90%; max-width: 450px; background: white; border-radius: 20px; padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .history-header { font-weight: bold; color: var(--primary); margin-bottom: 15px; border-bottom: 2px solid #f1f5f9; padding-bottom: 10px; }
        
        table { width: 100%; border-collapse: collapse; }
        th { color: #64748b; font-size: 13px; padding: 10px; }
        td { padding: 12px 5px; border-bottom: 1px solid #f1f5f9; text-align: center; font-weight: bold; font-size: 14px; }

        .btn-del-item { color: var(--minus); border: none; background: none; cursor: pointer; font-size: 18px; }

        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 4000; justify-content: center; align-items: center;
        }
        .modal-content {
            background: white; padding: 25px; border-radius: 20px; width: 85%; max-width: 350px; text-align: center;
        }
        .modal-btns { display: flex; gap: 10px; margin-top: 20px; }
        .modal-btns button { flex: 1; padding: 12px; border-radius: 10px; border: none; font-family: 'Cairo'; font-weight: bold; cursor: pointer; }
        .confirm-btn { background: var(--primary); color: white; }
        .cancel-btn { background: #e2e8f0; color: #475569; }

        #toast {
            position: fixed; bottom: 20px; background: #333; color: white;
            padding: 10px 25px; border-radius: 50px; display: none; z-index: 5000;
        }
    </style>
</head>
<body>

<div class="app-container">
    <header>
        <img src="https://image2url.com/r2/default/images/1771194774875-a0a45af5-73d3-4219-8403-d5fe683da053.png" alt="Ø§Ù„Ø´Ø¹Ø§Ø±">
        <h1>Ù…Ø±Ø·Ø¨Ø§Øª Ø§Ù„Ø£Ù…ÙŠØ±</h1>
        <div class="meal-counter-badge">Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ¬Ø¨Ø§Øª Ø§Ù„ÙƒÙ„ÙŠ: <span id="total-meals-count">0</span></div>
    </header>

    <div class="item-card">
        <div class="item-name">Ù…Ø«Ù„Ø¬Ø§Øª (250)</div>
        <div class="controls">
            <button class="btn btn-plus" onclick="fastUpdate('quarter', 1)">+</button>
            <div class="counter-val" id="quarter-val">0</div>
            <button class="btn btn-minus" onclick="fastUpdate('quarter', -1)">-</button>
        </div>
    </div>

    <div class="item-card">
        <div class="item-name">Ù…Ø«Ù„Ø¬Ø§Øª (500)</div>
        <div class="controls">
            <button class="btn btn-plus" onclick="fastUpdate('half', 1)">+</button>
            <div class="counter-val" id="half-val">0</div>
            <button class="btn btn-minus" onclick="fastUpdate('half', -1)">-</button>
        </div>
    </div>

    <button class="btn-new-meal" onclick="askConfirm('FINISH', null, 'Ù‡Ù„ Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø®Ù„Ø·Ø© ÙˆØªØ±ÙŠØ¯ Ø­ÙØ¸Ù‡Ø§ ÙˆØªØµÙÙŠØ± Ø§Ù„Ø¹Ø¯Ø§Ø¯ØŸ')">âœ… Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„ÙˆØ¬Ø¨Ø© ÙˆØ§Ù„Ø¨Ø¯Ø¡ Ø¨Ø¬Ø¯ÙŠØ¯</button>
</div>

<div class="history-container">
    <div class="history-header">ğŸ“œ Ø³Ø¬Ù„ Ø§Ù„ÙˆØ¬Ø¨Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</div>
    <table>
        <thead><tr><th>Ø§Ù„ÙˆÙ‚Øª</th><th>250</th><th>500</th><th>Ø­Ø°Ù</th></tr></thead>
        <tbody id="history-body"></tbody>
    </table>
</div>

<div id="confirmModal" class="modal-overlay">
    <div class="modal-content">
        <h3 id="modalMsg" style="margin-top: 0; color: var(--primary);">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ</h3>
        <div class="modal-btns">
            <button class="confirm-btn" id="modalConfirmBtn">Ù†Ø¹Ù…</button>
            <button class="cancel-btn" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div>
</div>

<div id="toast">ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ…</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBpt495yhuoTbjunCLIFCF_8c1NesxZHWs",
        authDomain: "shopweb-3466b.firebaseapp.com",
        databaseURL: "https://shopweb-3466b-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "shopweb-3466b",
        storageBucket: "shopweb-3466b.firebasestorage.app",
        messagingSenderId: "41811528812",
        appId: "1:41811528812:web:618f240f8106f218a8dc49"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const currentPath = "alasmer_refreshments/current/";
    const historyPath = "alasmer_refreshments/history/";

    function fastUpdate(type, change) {
        db.ref(currentPath + type).transaction(v => {
            let res = (v || 0) + change;
            return res < 0 ? 0 : res;
        });
    }

    function askConfirm(action, key, msg) {
        document.getElementById('modalMsg').innerText = msg;
        document.getElementById('confirmModal').style.display = 'flex';
        document.getElementById('modalConfirmBtn').onclick = () => {
            if(action === 'FINISH') saveMeal();
            if(action === 'DEL_ITEM') db.ref(historyPath + key).remove();
            closeModal();
        };
    }

    function closeModal() { document.getElementById('confirmModal').style.display = 'none'; }

    function saveMeal() {
        db.ref(currentPath).once('value', snap => {
            const data = snap.val();
            if(!data || (data.quarter === 0 && data.half === 0)) return;
            const time = new Date().toLocaleTimeString('ar-EG', {hour:'2-digit', minute:'2-digit'});
            db.ref(historyPath).push({ time, quarter: data.quarter, half: data.half });
            db.ref(currentPath).set({ quarter: 0, half: 0 });
            showToast("ØªÙ… Ø­ÙØ¸ Ø§Ù„ÙˆØ¬Ø¨Ø© ÙˆØªØµÙÙŠØ± Ø§Ù„Ø¹Ø¯Ø§Ø¯");
        });
    }

    db.ref(currentPath).on('value', snap => {
        const d = snap.val() || { quarter: 0, half: 0 };
        document.getElementById('quarter-val').innerText = d.quarter || 0;
        document.getElementById('half-val').innerText = d.half || 0;
    });

    db.ref(historyPath).on('value', snap => {
        const body = document.getElementById('history-body');
        const countSpan = document.getElementById('total-meals-count');
        body.innerHTML = "";
        const data = snap.val();
        
        if(data) {
            const keys = Object.keys(data);
            countSpan.innerText = keys.length;
            keys.reverse().forEach(k => {
                const m = data[k];
                body.innerHTML += `<tr>
                    <td>${m.time}</td>
                    <td style="color:var(--plus)">${m.quarter}</td>
                    <td style="color:var(--primary)">${m.half}</td>
                    <td><button class="btn-del-item" onclick="askConfirm('DEL_ITEM', '${k}', 'Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¬Ø¨Ø©ØŸ')">âŒ</button></td>
                </tr>`;
            });
        } else {
            countSpan.innerText = "0";
            body.innerHTML = "<tr><td colspan='4'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„</td></tr>";
        }
    });

    function showToast(msg) {
        const t = document.getElementById('toast');
        t.innerText = msg + " âœ…";
        t.style.display = 'block';
        setTimeout(() => t.style.display = 'none', 2000);
    }
</script>
</body>
</html>
